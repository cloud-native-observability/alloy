beyla.ebpf "default" {
  open_port = "8443"
  debug = true
  executable_name = "otel-metrics-gen"
  metrics {
    features = ["application_process"]
  }
}

prometheus.scrape "beyla" {
  targets = beyla.ebpf.default.targets
  honor_labels = true
  forward_to = [prometheus.remote_write.beyla.receiver]
}

prometheus.remote_write "beyla" {
  endpoint {
    url = "http://mimir:9009/api/v1/push"
    queue_config {
      max_samples_per_send = 100
    }
  }

  external_labels = {
    test_name = "beyla",
  }
}
